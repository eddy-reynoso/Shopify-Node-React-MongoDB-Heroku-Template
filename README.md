# Shopify App Node

[![License: MIT](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE.md)
[![Build Status](https://travis-ci.com/Shopify/shopify-app-node.svg?branch=master)](https://travis-ci.com/Shopify/shopify-app-node)

Boilerplate to create an embedded Shopify app made with Node, [Next.js](https://nextjs.org/), [MongoDB](https://www.mongodb.com/atlas-signup-from-mlab), [Heroku](https://signup.heroku.com/), [Shopify-koa-auth](https://github.com/Shopify/quilt/tree/master/packages/koa-shopify-auth), [Polaris](https://github.com/Shopify/polaris-react), and [App Bridge React](https://shopify.dev/tools/app-bridge/react-components).

## Introduction
This app template was generated by the Shopify CLI and modified to support development and production environments, connections to MongoDB and deploys to Heroku.

## Requirements
- If you don’t have one, [create a Shopify partner account](https://partners.shopify.com/signup).
- If you don’t have one, [create a Development store](https://help.shopify.com/en/partners/dashboard/development-stores#create-a-development-store) where you can install and test your app.
- In the Partner dashboard, [create two new apps](https://help.shopify.com/en/api/tools/partner-dashboard/your-apps#create-a-new-app). One app will be for dev and one app will be for prod. You’ll need both app’s API credentials during the setup process.
<img width="1280" alt="Screen Shot 2021-07-27 at 8 14 25 AM" src="https://user-images.githubusercontent.com/47189260/127151963-ce2e1251-cbc0-4b57-9983-73e34c487a97.png">

- If you don’t have one, [sign up for a Heroku Account](https://signup.heroku.com/) where you can deploy your app.
- You will need MongoDB access to set up databases. You can set these databases locally but [Mongo Atlas is also a good free option](https://www.mongodb.com/atlas-signup-from-mlab),

# Database set up
- Create one MongoDB database for dev and one MongoDB database for prod.
- Save both connection strings. These will be used as enviornment variables on both dev and prod.
- If created using Mongo Atlas, the connection strings will be in the form `mongodb+srv://<username>:<password>@<cluster>.mongodb.net/<database>?retryWrites=true&w=majority`.
- You will need to fill in your own username, password, cluster and database.
<img width="603" alt="Screen Shot 2021-07-27 at 7 43 59 AM" src="https://user-images.githubusercontent.com/47189260/127148592-cddafcd2-d876-42f8-b1ce-b76a20e1a023.png">



# Environment Variable setup (Dev)
- Create a `.env` file in the root directory of the project (follow the format of the .env.example file for reference).
- Retrieve the API Key and API Secret from your dev app and save in the `.env` file as SHOPIFY_API_KEY and SHOPIFY_API_SECRET.
<img width="1280" alt="Screen Shot 2021-07-27 at 8 08 51 AM" src="https://user-images.githubusercontent.com/47189260/127151229-62416cee-6357-471c-a449-836da8bf60b4.png">

- Retrieve the dev MongoDB connection string and save in the `.env` file as MONGO_DB_URI.
<img width="1280" alt="Screen Shot 2021-07-27 at 8 10 44 AM" src="https://user-images.githubusercontent.com/47189260/127151694-bcca5e36-03f0-4e32-be55-0e4d3b2e9101.png">

- Your .env file should look like the following:
```sh
    SHOPIFY_API_KEY="YOUR_SHOPIFY_API_KEY"
    SHOPIFY_API_SECRET="YOUR_SHOPIFY_SECRET"
    SHOP="my-shop-name.myshopify.com"
    SCOPES=read_products
    MONGO_DB_URI="YOUR MONGODB CONNECTION STRONG"
```


# Heroku Setup (Prod)
- Set up a new Heroku app on the [Heroku dashboard](https://dashboard.heroku.com/apps).
- Copy the `API Key` and `API Secret` from your production app on the [partners dashboard](https://partners.shopify.com/) to the [Heroku Config Variables](https://devcenter.heroku.com/articles/config-vars). Save as `SHOPIFY_API_KEY` and `SHOPIFY_API_SECRET`.
<img width="1280" alt="Screen Shot 2021-07-27 at 7 51 33 AM" src="https://user-images.githubusercontent.com/47189260/127149309-c4f35371-ec1c-43c7-95fe-433d97e53717.png">

- Copy the `production MongoDB connection string` to the [Heroku Config Variables](https://devcenter.heroku.com/articles/config-vars). Save as `MONGO_DB_URI`.
<img width="1278" alt="Screen Shot 2021-07-27 at 7 55 08 AM" src="https://user-images.githubusercontent.com/47189260/127153575-4d7b2482-1a9b-487e-8614-ba5cb9c32f8f.png">


- Copy the `Heroku app url` to the [Heroku Config Variables](https://devcenter.heroku.com/articles/config-vars). Save as HOST.
<img width="1280" alt="Screen Shot 2021-07-27 at 8 01 22 AM" src="https://user-images.githubusercontent.com/47189260/127150324-198bb5d7-d78c-4c2c-9d8c-cdef598557ed.png">

- Copy the the `Heroku app URL` to the `App Url` field of the Prod Shopify app and the `App Url` with `auth/callback` appended in the Allowed redirection URL(s) field.

<img width="1280" alt="Screen Shot 2021-07-27 at 8 04 00 AM" src="https://user-images.githubusercontent.com/47189260/127150679-829f0f48-9952-4c01-95a0-f8a02668edf8.png">

- Follow the steps outlined on the app's Heroku Dashboard to deploy the app. 
<img width="1280" alt="Screen Shot 2021-07-27 at 8 06 36 AM" src="https://user-images.githubusercontent.com/47189260/127150803-0b90ffc7-cea9-4a9a-8610-15829e7be6d3.png">

# Running the app on a development store (Dev):
- Ensure that the app is running with:
```sh
~/ $ shopify node serve
```
- On the Shopify Partner Dashboard, navigate to the dev app and under `More Actions`, select `Test on development store`.
<img width="950" alt="Screen Shot 2021-07-27 at 8 20 42 AM" src="https://user-images.githubusercontent.com/47189260/127152807-83f958ce-c756-4339-9f5d-cd8ba47779a8.png">

# Running the app on a development store (Prod):
- Ensure that the app is deployed to Heroku and running.
- On the Shopify Partner Dashboard, navigate to the prod app and under `More Actions`, select `Test on development store`.
<img width="759" alt="Screen Shot 2021-07-27 at 8 23 14 AM" src="https://user-images.githubusercontent.com/47189260/127153026-1b432ef1-3bed-49f4-851c-b9793bf68672.png">

# Deploying the app to production (Prod):
- To deploy to heroku in one command run with a commit message:
```sh
~/ $ MESSAGE"Your commit message" npm run deploy
```
- To deploy to heroku in one command run with a default commit message:
```sh
~/ $ npm run deploy
```
- To deploy to heroku using the Github cli run:
```sh
~/ $ git add .
~/ $ git commit -am "Your commit message"
~/ $ gitpush heroku master
```
## License

This respository is available as open source under the terms of the [MIT License](https://opensource.org/licenses/MIT).
